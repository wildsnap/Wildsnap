generator client {
  provider     = "prisma-client"
  output       = "../generated/prisma"
  moduleFormat = "cjs"
  binaryTargets = ["native", "rhel-openssl-1.0.x", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
}

model User {
  id                Int               @id @default(autoincrement())
  email             String?           @unique
  createdAt         DateTime          @default(now())
  currentPoints     Int               @default(0)
  password          String?
  totalPointsEarned Int               @default(0)
  updatedAt         DateTime          @updatedAt
  username          String            @unique
  clerkId           String            @unique
  scanLogs          ScanLog[]
  achievements      UserAchievement[]
  collections       UserCollection[]
  inventory         UserInventory[]
  missions          UserMission[]
}

model Animal {
  id             Int              @id @default(autoincrement())
  name           String
  scientificName String?
  description    String?
  funFact        String?
  habitat        String?
  rarityLevel    Rarity           @default(COMMON)
  imageUrl       String?
  shadowImageUrl String?
  pointsReward   Int              @default(0)
  missions       Mission[]
  scanLogs       ScanLog[]
  collectedBy    UserCollection[]
}

model Story {
  id          Int       @id @default(autoincrement())
  title       String
  description String?
  createdAt   DateTime  @default(now())
  missions    Mission[]
}

model UserCollection {
  id               Int      @id @default(autoincrement())
  userId           Int
  animalId         Int
  capturedAt       DateTime @default(now())
  isFirstDiscovery Boolean  @default(true)
  customName       String?
  animal           Animal   @relation(fields: [animalId], references: [id])
  user             User     @relation(fields: [userId], references: [id])

  @@unique([userId, animalId])
}

model ScanLog {
  id                Int      @id @default(autoincrement())
  userId            Int
  imageUrl          String?
  status            String
  predictedAnimalId Int?
  confidenceScore   Float?
  createdAt         DateTime @default(now())
  animal            Animal?  @relation(fields: [predictedAnimalId], references: [id])
  user              User     @relation(fields: [userId], references: [id])
}

model Mission {
  id           Int           @id @default(autoincrement())
  title        String
  description  String?
  missionType  MissionType
  animalId     Int?
  storyId      Int?
  targetValue  Int           @default(1)
  rewardPoints Int           @default(0)
  createdAt    DateTime      @default(now())
  animal       Animal?       @relation(fields: [animalId], references: [id])
  story        Story?        @relation(fields: [storyId], references: [id])
  userMissions UserMission[]
}

model UserMission {
  id              Int       @id @default(autoincrement())
  userId          Int
  missionId       Int
  currentProgress Int       @default(0)
  isCompleted     Boolean   @default(false)
  completedAt     DateTime?
  mission         Mission   @relation(fields: [missionId], references: [id])
  user            User      @relation(fields: [userId], references: [id])
}

model Achievement {
  id               Int               @id @default(autoincrement())
  name             String
  description      String?
  criteriaType     String
  targetValue      Int
  rewardPoints     Int
  userAchievements UserAchievement[]
}

model UserAchievement {
  id              Int         @id @default(autoincrement())
  userId          Int
  achievementId   Int
  currentProgress Int         @default(0)
  isCompleted     Boolean     @default(false)
  completedAt     DateTime?
  achievement     Achievement @relation(fields: [achievementId], references: [id])
  user            User        @relation(fields: [userId], references: [id])
}

model Item {
  id          Int             @id @default(autoincrement())
  name        String
  description String?
  price       Int
  type        ItemType
  imageUrl    String?
  inventory   UserInventory[]
}

model UserInventory {
  id          Int      @id @default(autoincrement())
  userId      Int
  itemId      Int
  purchasedAt DateTime @default(now())
  isEquipped  Boolean  @default(false)
  item        Item     @relation(fields: [itemId], references: [id])
  user        User     @relation(fields: [userId], references: [id])
}

enum Rarity {
  COMMON
  UNCOMMON
  RARE
  LEGENDARY
}

enum MissionType {
  SCAN_ANIMAL
  COLLECT_ANIMAL
  READ_STORY
  FOLLOW_STORY
}

enum ItemType {
  AVATAR_OUTFIT
  AVATAR_ACCESSORY
  ANIMAL_DECORATION
  REAL_WORLD_COUPON
}
